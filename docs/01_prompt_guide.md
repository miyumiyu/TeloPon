# TeloPon: AIプロンプト作成ガイド 🧠

TeloPonでは、AIの「性格」や「振る舞い」を **プロンプトファイル（テキストファイル）** で簡単にカスタマイズできます。

このガイドでは、オリジナルのAIアシスタントを作るためのプロンプトファイルの書き方と、システムをエラーなく爆速で動かすための「絶対のルール」を解説します。

---

## 📂 1. ファイルの作成と保存場所

プロンプトファイルは、TeloPon本体があるフォルダ内の **`prompts`** フォルダに保存します。保存したファイルは、TeloPon起動時のメイン画面（AIの性格）から自由に選べるようになります。

* **保存場所**: `TeloPon/prompts/`
* **ファイル名**: 自由につけて構いません（例: `miyumiyu_assistant.txt`、`dokuzetsu.txt`など）。先頭に特定の文字を付ける必要もありません。
* **文字コード**: 必ず **UTF-8** で保存してください。

> **💡 ヒント**
> Windowsの「メモ帳」で作成する場合は、「名前を付けて保存」する際に、右下の文字コード欄が「UTF-8」になっていることを確認してください。

---

## 🏗️ 2. ファイルの基本構造

プロンプトファイルは、大きく分けて**「ヘッダー（設定）」**と**「本文（AIへの指示）」**の2つのブロックで構成されます。
この2つのブロックは、必ず **`---` (ハイフン3つ)** の行で区切る必要があります。

```text
NAME: AIの名前
START_MSG: 起動時のシステムメッセージ
CMT_MSG: コメント受信時の指示文
---
ここから下に、AIへの詳しい指示（システムプロンプト）を書きます。
あなたは優秀なアシスタントです...
```

---

## ⚙️ 3. ヘッダーの書き方と、便利な「差し込み文字」

ファイルの一番上（`---` より上）に、以下の3つの項目を1行ずつ記述します。

* **`NAME:`**  
  AIの名前です。UIのスタンバイ画面や、デフォルトのトピックとして表示されます。
* **`START_MSG:`**  
  ライブ接続を開始した直後に、システムからAIにコッソリ送られる最初のメッセージ（カンペ）です。これをキッカケにAIが最初の挨拶を始めます。
* **`CMT_MSG:`**  
  YouTubeのコメントなどが届いた際に、コメントデータの末尾に自動で付与される指示です。

### 🪄 魔法の「差し込み文字（変数）」について
プロンプトのヘッダーや本文の中で以下の文字を使うと、TeloPonが実行時に**実際の名前**へと自動的に置き換えてAIに伝えます。
これにより、「配信者が変わるたびにプロンプトを書き換える」という手間が省け、汎用性の高いプロンプトを作ることができます。

* **`{streamer}`**  
  TeloPonのメイン画面（UI）の「🎥 配信者名」欄に入力された名前に置き換わります。
  *(例)* `[MAIN]今日の{streamer}はちょっと変ですね。` → UIで「みゅみゅ」と設定していれば `[MAIN]今日のみゅみゅはちょっと変ですね。` と発話します。
* **`{ai_name}`**  
  ヘッダーの `NAME:` で設定したAIの名前に置き換わります。
  *(例)* `あなたの名前は「{ai_name}」です。` → `あなたの名前は「てろぽん」です。` とAIが認識します。

---

## 🎨 4. テロップを彩る「強調タグ」の使い方

AIのセリフ（`[MAIN]`タグの中身）をただ表示するだけでなく、特定の言葉に色を付けて強調することで、よりテレビ番組らしいリッチなテロップになります。
プロンプトの中でAIに「重要な言葉はタグで囲んで」と指示することで、自動で色付けをしてくれます。

* **`<b1>文字</b1>` （赤色・強調）**  
  一番目立たせたい言葉、ツッコミのオチ、重要なキーワードに使います。
  デフォルトテーマでは**赤色**（またはアクセントカラー）で表示されます。
* **`<b2>文字</b2>` （青色・補足）**  
  二番目に目立たせたい言葉、補足情報などに使います。
  デフォルトテーマでは**青色**（またはサブカラー）で表示されます。

**【AIへの指示例】**
> セリフ内の重要な言葉は `<b1>...</b1>` (赤) や `<b2>...</b2>` (青) で囲んで強調してください。

**【出力と表示のイメージ】**
`[MAIN] 今日の配信は<b1>重大発表</b1>があります！<b2>絶対見てね</b2>！`  
👉 「重大発表」が赤く、「絶対見てね」が青く装飾されて画面に表示されます。

---

## 🚨 5. 【超重要】絶対に守らせるべき「出力フォーマット（タグ方式）」

TeloPonのシステムをエラーなく超高速に動かすために、絶対にAIに守らせなければならない「出力ルール（タグ方式）」があります。AIがこのルールを破ると、OBSにテロップが表示されなかったり、フリーズしたりします。
**以下のルール文は、必ずプロンプトの末尾などにそのまま貼り付けて（コピペして）ください。**

```text
【絶対ルール：テロップ出力フォーマット】
あなたは回答を、必ず以下の「専用タグ」を用いた書式で出力しなければなりません。
1回の発言につき、出力するテロップは「必ず1つ」としてください。複数パターンの出力や、タグの繰り返しは厳禁です。
装飾（Markdownの太字や箇条書きなど）や、タグ以外の前置き・返事は一切使用してはいけません。即座にタグから出力してください。

[TOPIC] トピック名 [MAIN] メインテキスト [WND] ウィンドウID [LAY] レイアウトID [BDG] バッジ [MEMO] AIの脳内メモ
```

### 各タグの意味と役割
1. **`[TOPIC]`**: テロップの左上に出る小さな見出し（例: `AIアシスタント`、`速報`）
2. **`[MAIN]`**: 画面に表示されるセリフ本体。ここで強調タグ（`<b1>`など）を使います。
3. **`[WND]`**: テロップの枠デザイン。（例: `window-simple`, `window-explain`, `window-news`など）
4. **`[LAY]`**: テロップの表示スタイル。基本は `layout-flat` で固定。
5. **`[BDG]`**: テロップの隅に付く小さなアイコンや文字。（不要な場合は `NONE`）
6. **`[MEMO]`**: 次の会話に繋げるための内部メモ。**システムはこの[MEMO]タグを検知した瞬間に画面表示を開始するため、必ず最後に書いてください。**

---

## 🚑 6. うまく動かないときは？（思考モードの活用）

「AIがずっと黙り込んでいる」「たまにしか喋らない」「なぜか変な返事をする」といった場合、プロンプトの指示がAIを混乱させている可能性があります。
そんな時は、TeloPonを起動する際に **`-th`（思考モード）オプション** を付けてみてください。

**【起動方法の例】**
```bash
python telopon_live.py -d -th
```

思考モードをオンにすると、コマンドプロンプト（黒い画面）のログに **`[THOUGHT] 🧠`** という項目が表示されるようになります。
これは、AIが「今マイクからどんな音を聞き取ったか」「なぜその回答を選んだのか（あるいはなぜスキップしたのか）」という**脳内の思考プロセス**です。

* **「雑音を宇宙語と勘違いしているな…」**
* **「プロンプトの制限が厳しすぎて、AIが『今は喋ってはいけない』と委縮しているな…」**
* **「マイクの音が途切れて、思考を何度もやり直しているな…」**

このように、AIが何に詰まっているのか（ボトルネック）が丸わかりになるため、プロンプトの修正やマイク環境の改善に非常に役立ちます。
※確認が終わったら、リアルタイムのテンポを良くするために `-th` オプションは外して通常起動に戻すことをお勧めします。

---

## 🎁 7. コピペで使える！基本のプロンプトサンプル

初めて作成する場合は、以下のテキストをコピーして `TeloPon/prompts/sample_assistant.txt` として保存し、TeloPonで読み込んでみてください。すぐに優秀なキャラクターアシスタントが誕生します。

```text
NAME: みゆみゆ
START_MSG: システム起動完了。{streamer}さん、今日の配信も頑張りましょう！まずは視聴者へご挨拶をお願いします。
CMT_MSG: ※視聴者から新着コメントが届きました。これを話題のキッカケにして番組を回してください。
---
あなたは配信者「{streamer}」のアシスタントを務めるバーチャルキャラクター「{ai_name}」です。
視聴者からのコメントを拾ったり、マイクの音声に反応してライブ配信を盛り上げてください。

【行動指針】
- 常に明るく、親しみやすいトーンで話します。
- 沈黙を嫌います。{streamer}が言葉に詰まったら、すかさずツッコミやガヤを入れて助けてください。
- 視聴者からのコメントは神様からの言葉として、最優先で大袈裟に喜んで拾ってください。

【絶対ルール：テロップ出力フォーマット（最重要）】
システムがあなたの発言を画面に超高速で表示するために、回答は**必ず**以下の「タグ方式」で1行だけで出力してください。
前置き、返事、Markdown装飾、およびタグセットの複数回出力（キメラ化）は一切禁止です。
セリフ内の重要な言葉は <b1>...</b1>(赤) や <b2>...</b2>(青) で囲んで強調してください。

[TOPIC] トピック [MAIN] あなたの発言内容 [WND] ウィンドウID [LAY] レイアウトID [BDG] バッジ [MEMO] あなたの内部メモ

[項目の詳細]
- [TOPIC]: {ai_name} または 現在の話題の短いタイトル
- [MAIN]: あなたの発言内容（これがテロップとして表示されます）
- [WND]: 「window-simple」を必ず使用してください。
- [LAY]: 「layout-flat」を必ず使用してください。
- [BDG]: 感情などの絵文字1文字（例: 💡, 🧪）。不要な場合は NONE。
- [MEMO]: 今後の展開に向けた備忘録（※このタグを検知してシステムが動作するため、必ず最後に書いてください）。

[出力例]
[TOPIC] {ai_name} [MAIN] 配信スタートですね！今日も<b1>元気いっぱい</b1>頑張りましょう！ [WND] window-simple [LAY] layout-flat [BDG] ✨ [MEMO] 最初の挨拶を完了。コメント待ち。
```
