# TeloPon (てろぽん) 🎙️✨

**超低遅延・高機能 AI配信支援システム**

TeloPonは、Googleの最新AI「Gemini Live API」を活用し、配信者の声を聞き取って**リアルタイムに相槌・ツッコミ・要約をテロップとして表示する**、次世代の配信アシスタントツールです。

単なる「文字起こしソフト」ではありません。あなたの配信に、優秀で個性豊かな「AIの相方」を召喚します！

![TeloPon実行画面](docs/images/demo.gif)

---

## 🌟 TeloPonのすごいところ！

![TeloPon特徴](docs/images/telopon1.png)

### 1. 圧倒的な「超低遅延」と「文脈理解」
GeminiのネイティブオーディオAPIを直接叩くことで、従来の「音声認識→テキスト化→AIへ送信」という時間のかかるステップを完全に排除。配信者の言葉のニュアンス、ため息、笑い声すらも瞬時に読み取り、**会話のテンポを崩さない小気味よいレスポンス**を画面に返します。

### 2. 自分だけのAIを作れる「プロンプト設定」
「プロンプト（AIの台本・性格設定書）」をテキストファイルで自由に作成可能！
「あなたは関西弁の元気なアシスタントです」「私が言葉に詰まったら容赦なく毒舌でツッコミを入れてください」など、日本語で指示を書くだけで、**どんなキャラクターのAIでも簡単に生み出す**ことができます。

### 3. 画像にも対応！無限の拡張性「プラグイン機能」
配信者のマイク音声だけでなく、外部の情報をリアルタイムにAIへ「コッソリ耳打ち」できる拡張機能を搭載。
* **YouTube連携**: 配信のコメントをAIに読ませて一緒に番組を回す！
* **手動データ注入パネル**: 配信中にボタン1つで「カンペ」を出したり、**「画像」を見せて感想を言わせる**ことも可能！
Pythonの簡単なスクリプトを書くだけで、独自の連携機能（ゲーム連動など）を追加できます。

### 4. CSSで完全自由な「テロップデザイン」
OBS上に表示されるテロップは、すべてHTML/CSSで描画されています。
ニュース番組風、バラエティ番組風、サイバー風など、CSSを少し書くだけで自分好みのデザイン（テーマ）を無限に追加できます。**テロップ出現時の効果音（SE）も自由に設定可能**です。

### 5. OBSへの超簡単組み込み ＆ 沈黙回避システム
TeloPonを起動するだけで内蔵サーバーが立ち上がるため、OBSの「ブラウザソース」としてURLを追加するだけで準備完了。
さらに、配信者が無言になってしまった際に、AIが空気を読んで自発的に話題を振り、放送事故を防いでくれる **「Auto Talk（沈黙回避）」機能** も標準搭載しています。


## 🗺️ TeloPon アーキテクチャ

TeloPonは、 **「CORE（TeloPon コア）」** と呼ばれる中央システムが、マイク、AI（Google Gemini API）、OBS、そしてユーザー設定ファイルを繋ぐハブとして機能するアーキテクチャを採用しています。

以下は、そのデータの流れと各コンポーネントの役割を図解したものです。

![TeloPon アーキテクチャ図](docs/images/architecture.png)

### 🔄 データの流れと各部の役割

1. **🎤 マイク音声 & 指示 (Voice & Instruction)**
   * 配信者のマイクから入力された音声は、**CORE**を経由してリアルタイムに**Google Gemini API**へと送信されます。
   * 同時に、ユーザー設定領域にある**プロンプト(.txt)**ファイルの内容もAIへの指示として送られ、AIのキャラクターや振る舞いが決定されます。

2. **🤖 テロップ情報 (Telop Information)**
   * AIは音声と指示を基に思考し、その結果（発言内容、感情、表示スタイルなど）を**テロップ情報**としてCOREに返します。

3. **📺 描画データ & CSS読み込み (Drawing Data & CSS Loading)**
   * COREは受け取ったテロップ情報を、ブラウザで表示可能な**描画データ**（HTML）に変換します。
   * **OBS Studio（ブラウザソース）**はCOREにアクセスし、この描画データを表示します。
   * この際、ユーザー設定領域にある**テーマ(.css)**ファイルが読み込まれ、テロップのデザインやアニメーションが適用されます。

### 📂 拡張機能（プラグイン & ユーザー設定）

TeloPonは、ユーザーが自由にカスタマイズ・拡張できる仕組みを備えています。

* **ユーザー設定領域 (User Config Area)**
  * **プロンプト(.txt)**: AIの性格や台本を自由に記述できます。
  * **テーマ(.css)**: テロップのデザインやアニメーションをCSSで自由にカスタマイズできます。
  * **プラグインフォルダ**: 拡張機能（Pythonスクリプト）を配置する場所です。

* **プラグイン機能 (Plugin Features)**
  * プラグインを使うことで、外部の情報をAIに連携させることができます。
    * **文字情報**: YouTubeのコメントや、外部ツールのテキストデータをAIに送ります。
    * **画像情報**: 画像データをAIに送信し、その内容についてコメントさせることができます。
    * **プロンプト追加**: 状況に応じて、AIへの指示（プロンプト）を動的に追加・変更できます。

---

## 🔑 準備編：無料のAPIキーを取得しよう！

TeloPonを動かすには、Googleが提供しているAIの鍵（APIキー）が必要です。
**クレジットカード登録不要・完全無料の枠**が用意されており、個人の配信や趣味で遊ぶ分には無料枠で十分すぎるほど楽しめます！

1. **[Google AI Studio](https://aistudio.google.com/)** にアクセスし、Googleアカウントでログインします。
2. 左上の **「Get API key」** をクリックします。
3. **「Create API key」** ボタンを押します。
4. 「新しいキーを作成する」という画面が出ますが、設定は変更しなくて大丈夫です。
   * プロジェクト選択欄などが表示された場合は、そのまま **「キーを作成」** ボタンを押してください。
5. 表示された「AIza...」から始まる文字列をコピーして大切に保管してください（絶対に他人に教えないでください）。
   * ※**無料枠 (Free Tier)** の範囲内で十分に使えますが、利用規約等はGoogleのサイトでご確認ください。

---

## 🛠️ インストールと起動（初心者向けガイド）

TeloPonは「Python（パイソン）」というプログラムで動いています。Windows / Mac の両方に対応しています。

### ステップ1：Pythonのインストール
まだパソコンにPythonが入っていない場合は、公式サイトからインストールしてください。

1. [Python公式サイト](https://www.python.org/downloads/) にアクセスし、「Download Python 3.11.x」をダウンロードします。（※3.11〜3.12推奨）
2. インストーラーを起動します。
3. **⚠️超重要（Windowsのみ）：** 画面下にある **「Add Python to PATH（または Add python.exe to PATH）」** に**必ずチェックを入れてから**、「Install Now」を押してください。ここを忘れると起動しません！

### ステップ2：ファイルのダウンロード
このページの緑色の「Code」ボタン → 「Download ZIP」からファイルをダウンロードし、好きな場所（デスクトップやマイドキュメントなど）に解凍してください。

### ステップ3：仮想環境 (venv) の作成とインストール
解凍したフォルダの中に「TeloPon専用の実行環境」を作ります。

1. 解凍した **「TeloPon」フォルダ**（`telopon_live.py`等があるフォルダ）を開きます。
2. ターミナルを開きます。
   * **Windows**: フォルダ上部のアドレスバー（パスが書いてある所）をクリックして消し、半角で `cmd` と入力してEnterを押します。黒い画面が開きます。
   * **Mac**: ターミナルアプリを開き、`cd `（スペースあり）と打った後にフォルダをドラッグ＆ドロップしてEnterを押します。
3. 黒い画面に以下のコマンドをコピー＆ペーストしてEnterを押し、仮想環境を作成します。
   ```bash
   python -m venv venv
   ```
4. 作成した仮想環境の中に入ります（**※OSによってコマンドが異なります**）。
   * **Windowsの場合**:
     ```bash
     venv\Scripts\activate
     ```
   * **Macの場合**:
     ```bash
     source venv/bin/activate
     ```
   ※成功すると、黒い画面の行の先頭に `(venv)` という文字が表示されます。

5. TeloPonを動かすために必要な追加パーツを一括でインストールします。
   ```bash
   pip install -r requirements.txt
   ```
   （※もし赤い文字でエラーが出た場合は、ページ一番下の「トラブルシューティング」を見てください）

### ステップ4：起動する！

   インストールが終わったら、同じ画面で以下のコマンドを入力してEnterキーを押します。
   ```bash
   python telopon_live.py
   ```
   TeloPonの設定画面（UI）が立ち上がれば大成功です！ 🎉

---

## 🚀 起動オプション（引数）一覧

TeloPonの起動コマンドの後ろに「オプション」を付けることで、高度な設定やデバッグ（裏側の動きの確認）が可能です。

| オプション | コマンドの入力例 | 説明 |
| :--- | :--- | :--- |
| `-h` <br>`--help` | `python telopon_live.py -h` | **ヘルプを表示**<br>利用可能なオプションの一覧を表示して終了します。 |
| `-d` <br>`--debug` | `python telopon_live.py -d` | **デバッグモードを有効にする（おすすめ！）**<br>AIがマイクからどんな音を拾っているか、AIにどんな画像が送られたか等の詳細な通信ログを黒い画面に出力します。手動でテロップを出せる操作パネルもUIに表示されます。 |
| `-p` <br>`--port` | `python telopon_live.py -p 8080` | **ポート番号の変更** (デフォルト: `8000`)<br>OBSに繋ぐためのローカルサーバーのポートを変更します。他のソフトと競合して画面が出ない時などに使います。 |
| `-t` <br>`--temperature` | `python telopon_live.py -t 1.0` | **AIの創造性 (Temperature)** (デフォルト: `1.5`)<br>AIの回答のランダム性を0.0〜2.0の範囲で設定します。数値が高いほど突飛で面白い発言になりやすく、低いほど真面目になります。 |
| `-st` <br>`--strict_turn` | `python telopon_live.py -st 5` | **完全ターン制モード（マイクの自動ロック）**<br>自分が話し終わった後にマイクを一時的にロックし、AIの返事を待つモードです。会話が被るのを防ぎたい時に便利です。数字でAIの返事を待つタイムアウト秒数を指定できます（省略時は10秒、`0`で無限）。 |
| `-th` <br>`--thought` | `python telopon_live.py -th` | **思考モードの有効化**<br>AIが「今何を考えて、なぜその返事をしたのか」という脳内の思考プロセスを黒い画面に表示します。プロンプトが上手く動かない時の原因究明に便利です。（※通常の配信時はオフ推奨） |
| `-tb` <br>`--thinking_budget` | `python telopon_live.py -tb 1024` | **思考予算（トークン数）の指定** (デフォルト: `0`)<br>思考モード時のトークン予算を指定します。通常は爆速レスポンスのため `0` (思考オフ) が推奨です。 |

*(例：デバッグモードかつ、完全ターン制(5秒待ち)で起動する場合)*
```bash
python telopon_live.py -d -st 5
```

---

## 🎛️ TeloPon画面（UI）の使いかた

![UI画面](docs/images/ui.png)

### ⚙️ AI設定（基本設定）
* **🔑 API Key**: 先ほど取得した `AIza...` から始まるキーを貼り付けて、「認証」ボタンを押してください。「✅ 認証成功」と出れば準備完了です。
* **🧠 使用モデル**: 基本は `Auto` （最新の音声対応モデルを自動選択）のままで大丈夫です。
* **🧠 AIの性格 (Prompt)**: AIのキャラクター（台本）を選びます。自分で作ったプロンプトファイルを追加することも可能です。
* **🎥 配信者名 (※必須項目)**: あなたのお名前を入力してください。AIがあなたを呼ぶときに使います。
* **🎤 マイク選択**: あなたが喋るマイクを選んでください。下の緑色のメーターが声に合わせて「緑〜黄色」に動けば正常です。（赤に振り切れると音が割れてAIに伝わりません）

### ⏱️ タイマー設定（進行サポート）
* **自動介入(秒)**: 別名「沈黙回避システム」です。あなたがここで設定した秒数（例: 30秒）無言になると、**AIが空気を読んで自発的に「どうしたの？」などと話題を振り、放送事故を助けてくれます。**
* **表示切替(秒)**: 右上などに出る「通常テロップ」がOBS上で表示され続ける時間です。
* **特別枠表示(秒)**: 画面下部などに出る「解説テロップ」や「ツッコミ窓」などの大きなテロップが画面に表示され続ける時間です。読ませるために少し長めに設定するのがオススメです。

### 🔌 プラグイン（拡張機能）とテーマ
* **拡張機能**: YouTubeのコメントを自動取得したり、手動でカンペや画像を送るためのツール一覧です。「⚙️ 設定」や「🖥️ 操作パネル」ボタンから機能をオンにできます。
* **テーマ (CSS)**: OBSに表示されるテロップのデザイン（スキン）を着せ替えることができます。

**👉 すべての設定が終わったら「🔴 ライブ接続開始」ボタンを押すと、AIとのリアルタイム会話がスタートします！**

---

## 🚥 ステータス表示の見方

TeloPonの画面中段にある「状態」の表示は、AIの現在の脳内やシステムの通信状態をリアルタイムにお知らせするものです。配信中はこのステータスを見ることで、AIとスムーズにキャッチボールができます。

### 基本ステータス（待機・通常）
* **⬛ 待機中 (AI: 〇〇)**
  ライブ接続を開始する前の状態です。AIはまだ起きていません。
* **⏳ 最初の挨拶を準備中...**
  「ライブ接続開始」を押した直後の状態です。AIが配信のスタートを切るための「最初の挨拶」を考えています。数秒お待ちください。
* **🟢 放送中!**
  AIとの通話が確立され、スタンバイOKの状態です。マイクからあなたの声をいつでも拾うことができます。

### 対話ステータス（会話のキャッチボール）
* **🎧 聞き取り中...** (水色)
  マイクからあなたの声（または一定以上の音）を検知し、AIが耳を傾けている状態です。
* **🧠 思考中...** (オレンジ色)
  あなたが話し終わったのを検知し、AIが「なんて返そうかな？」と返答を考えている状態です。
  *(※「完全ターン制モード（-st）」で起動している場合は、ここにタイムアウトまでの残り秒数が表示され、その間はマイクがミュートされます)*
* **🗣️ 出力中...** (緑色)
  AIが考えをまとめ、テロップとして画面に出力している状態です。
* **⚠️ 割り込み検出 (Barge-in)** (赤色)
  AIが喋っている（出力している）最中にあなたが話し始めたため、AIが空気を読んで自分の発言を途中でキャンセルした状態です。

### 拡張機能・システム介入ステータス
* **🧠 画像を解析中... / 🧠 テキスト指示を解析中...** (オレンジ色)
  プラグイン（手動カンペやYouTube連携など）から、画像やテキストデータがAIの脳内に直接送り込まれた状態です。AIがそのデータを読み解いています。
* **⚡ 介入中 (データ生成中...)** (オレンジ色)
  「自動介入(秒)」で設定した時間以上、配信で無音（沈黙）が続いたため、システムがAIに「早く話題を振って放送事故を防げ！」と強制的にカンペを出している状態です。

### エラー・復旧ステータス
* **⚠️ 再接続中... (リトライ X回目)**
  ネットワークの瞬断などでGoogleのサーバーから切断された際、システムが自動で再接続を試みている状態です。
* **⚠️ 浄化＆再構築中... (X回目)**
  AIがテンションが上がりすぎて指示されたルール（タグの書き方など）を連続で破ったため、システムがAIの脳内を一度リセット（パージ）し、正常な状態に戻している最中です。
* **🔴 認証失敗 / 🔴 通信エラー発生**
  APIキーが間違っているか、回復不可能なネットワークエラーが発生しました。設定を見直して再起動してください。

---

## 📺 OBSへの組み込み方（超簡単！）

TeloPonは起動すると、あなたのPCの中に「見えない放送局（ローカルサーバー）」を作ります。OBSには専用のURLを入れるだけで繋がります。

1. TeloPonを起動した状態にしておきます。
2. OBS Studioを開き、ソースの「＋」ボタンから **「ブラウザ」** を追加します。
3. TeloPonの画面一番下にある **「🔗 OBS用URLコピー」** ボタンを押します（クリップボードにコピーされます）。
4. OBSのプロパティ画面で、コピーしたURL（`http://127.0.0.1:8000/?t=xxxxxxx` 等）を「URL」の欄に貼り付けます。
5. サイズを以下のように設定します（フルHD推奨）：
   - **幅 (Width):** `1920` （または `1664` 等お好みで）
   - **高さ (Height):** `1080` （または `936` 等お好みで）
6. 「OK」を押して、マイクに向かって喋りかけてください。数秒後に画面にテロップが出現します！

---

## 📖 開発・カスタマイズドキュメント

TeloPonをもっと自分好みに魔改造したい！という方向けに、詳細なガイドを用意しています。

* 🧠 **[AIプロンプト作成ガイド](docs/01_prompt_guide.md)**
  自分専用のAIの作り方や、システムを安定させるための「絶対ルール」について。
* 🎨 **[テーマ・CSS カスタマイズガイド](docs/02_theme_css.md)**
  自作のテロップデザインを作る方法や、CSSを使って効果音を鳴らす魔法のテクニックについて。
* 🧩 **[プラグイン開発ガイド](docs/03_plugin_dev.md)**
  AIに外部の情報を教える拡張機能（Pythonスクリプト）の作り方や、AIに「画像」を見せる仕組みについて。

---

## ❓ トラブルシューティング

### Q. 「PyAudio」のインストールで赤いエラーが出て止まる
マイクを使うためのツールがうまく入らないことがあります。OSに合わせて以下の対応をしてください。
* **Windowsの場合**: 黒い画面で `pip install pipwin` を実行後、続けて `pipwin install pyaudio` を実行してください。
* **Macの場合**: 先にHomebrewを使って `brew install portaudio` を実行してから、再度 `pip install pyaudio` をお試しください。

### Q. 認証ボタンを押しても「🔴 認証失敗」エラーが出る
- APIキーをコピーした際、前後に余計な「空白（スペース）」が入っていないか確認してください。
- エラーポップアップに表示されたメッセージを確認してください。「API key not valid」等の場合はキーが間違っています。

### Q. ずっと喋っているのにAIが「スキップ」や「無言ですか？」と返してくる
- **マイクの設定ミス**: TeloPonの「マイク選択」でゲーム音やBGMを拾うデバイスが選ばれている可能性があります。ご自身のヘッドセット等を選択し直してください。
- **チャンネル設定のミス**: `config.py` ファイルをテキストエディタで開き、`CHANNELS = 1` （モノラル）になっているか確認してください。`2`（ステレオ）になっていると、AI側に宇宙語として伝わってしまい認識されません。

### Q. OBSに何も表示されない
- OBSのブラウザソースのプロパティで「ローカルファイル」のチェックが外れているか確認してください。
- アプリの「OBS用URLコピー」ボタンでもう一度URLをコピーし直して貼り付けてみてください。

### Q. テロップが出現する音（SE）が出ない
- OBSのブラウザソースのプロパティで **「OBSで音声を制御する」のチェックが「外れている」** ことを確認してください。チェックが入っていると、配信には音が乗っても自分（配信者）には音が聞こえなくなります。

---

## ⚠️ 免責事項 (Disclaimer)

**本ツールは「Vibe Coding（AIとの対話によるライブコーディング）」によって開発されました。**

- **無保証:** 本ソフトウェアは「現状のまま（AS IS）」で提供されます。動作の完全性、正確性、安全性についてはいかなる保証も行いません。
- **自己責任:** 本ツールの使用によって生じたあらゆる損害（API利用料の発生、配信トラブル、PCの不具合など）について、開発者は一切の責任を負いません。ご利用は自己責任でお願いいたします。
- **コードの性質:** すべてAIによって生成されたコードなので、予期せぬ挙動や冗長な処理が含まれている可能性があります。

## 🤝 Special Thanks & Credits
- **Development Partner:** Google Gemini (Code Generation & Thought Partner)
- **Concept & Vibe:** [![miyumiyuna5](https://img.shields.io/badge/miyumiyuna5-%23000000.svg?style=for-the-badge&logo=X&logoColor=white)](https://x.com/miyumiyuna5)
- **Documentation:** This README was also generated by Gemini.

## 📜 ライセンス
MIT License
